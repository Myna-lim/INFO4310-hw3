<html>
    <h5 style="margin-bottom: 0px">Carly Hu (ch862) Myna Lim (ml2326) HW 3</h5>
    <h2 style="margin-top: 3px; margin-bottom: 0px;">FoodE</h2>
    <head>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>
        <script src='neighborhoods.js'></script> <!-- Boston map from a different source 
        https://github.com/maptimeBoston/d3-maptime/blob/gh-pages/example6/neighborhoods.js -->
    </head>
    <style>
        * {
            font-family: Verdana;
        }

    .gridlines line {
        stroke: #bbb;
      }
      
    .gridlines .domain {
    stroke: none;
    }

    .state {
      fill: lightgrey;
    }

    .neighbor_outline {
      fill: none;
      stroke: white;
      stroke-width: 0.6px;
    }


    .gridlines line {
        stroke: #bbb;
      }
      
    .gridlines .domain {
    stroke: none;
    }

    .choropleth{
        margin-top: 0px;
    }
    </style>

    <body>


        <p id="1_vis">
            <svg id="choropleth" height="670" width="900"  style="margin:0px; border:1px solid gray;" ></svg>
            <svg id="panel" height="670" width="500"  style="margin:0px; border:1px solid gray;" ></svg>
            <ul id="scales"></ul>
          <script>
            const svg = d3.select("#choropleth");
            const map = svg.append("g");
            const width = svg.attr("width");
            const height = svg.attr("height");
            const margin = { top: 100, right: 20, bottom: 20, left:0};
            const mapWidth = width - margin.left - margin.right;
            const mapHeight = height - margin.top - margin.bottom;

            let annotations = svg.append("g").attr("id","annotations");

            var projection = d3.geoAlbers()
                                        .scale(190000)
                                         .rotate([71.057, 0])
                                        .center([0, 42.313])
                                        .translate([width/2, height/2]);

            var path = d3.geoPath()
                            .projection(projection);

            
            map.selectAll('path')
                    .data(neighborhoods_json.features)
                    .enter()
                    .append('path')
                    .attr('fill', '#ccc')
                    .attr('d', path);

            const requestData = async function() {
                const yelp = await d3.csv('yelp_boston.csv');

                yelp.forEach( (d, i) => {
                        d.position = projection( [d.longitude, d.latitude] );
                        });

                map.selectAll("circle")
                    .data(yelp)
                    .join("circle")
                    .attr("cx", d => d.position[0])
                    .attr("cy", d => d.position[1])
                    .attr("r", 3)
                    .attr("opacity", 0.2)
                    .attr("d", path)
                    .style("fill",  "blue");

            
                var zoom = d3.zoom()
                            .scaleExtent([1,20])
                            .translateExtent([[-50,-50],[mapWidth+50,mapHeight+50]])
                            .on("zoom", mapZoomed);

                map.call(zoom);
                map.call(zoom.transform, d3.zoomIdentity); 
                
                function mapZoomed({transform}) {      
                map.attr("transform", transform.toString() );

                map.select(".state-outline")
                            .style("stroke-width", 2 / transform.k);
                map.select(".county-outline")
                            .style("stroke-width", 1 / transform.k);

                map.select(".county-outline")
                            .attr("visibility", (transform.k > 3) ? "visible" : "hidden");
                map.selectAll(".county")
                            .attr("visibility", (transform.k > 3) ? "visible" : "hidden");

                }

            } 
            requestData();
          </script>
      </p>
    </body>
</html>